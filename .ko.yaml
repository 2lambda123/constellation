defaltBaseImage: distroless.dev/static:latest@sha256:d624beaae60b10ec342896b1470421eb473549cb3ac3bf1c6ec074d8b460b4fc

baseImageOverrides:
  github.com/edgelesssys/constellation/v2/disk-mapper/cmd: leongross/alpine-libcryptsetup:base
  github.com/edgelesssys/constellation/v2/bootstrapper/cmd/bootstrapper: leongross/alpine-libcryptsetup:base

builds:
- id: kms
  dir: .
  main: ./kms/cmd
  env:
  - CGO_ENABLED=0
  flags:
  - -trimpath
  - -buildvcs=false
  ldflags:
  - -s -w -buildid=''
  - -X github.com/edgelesssys/constellation/v2/internal/constants.VersionInfo=${PROJECT_VERSION}
  - -extldflags "-static"

- id: joinservice
  dir: .
  main: ./joinservice/cmd
  env:
  - CGO_ENABLED=0
  flags:
  - -trimpath
  - -buildvcs=false
  ldflags:
  - -s -w -buildid=''
  - -X github.com/edgelesssys/constellation/v2/internal/constants.VersionInfo=${PROJECT_VERSION}
  - -extldflags "-static"

# currently ignoring USER 65532:65532 from Dockerfile operators/constellation/Dockerfile
- id: constellation-node-operator
  dir: .
  main: ./operators/constellation-node-operator/
  env:
  - CGO_ENABLED=0
  - GOOS=linux
  - GOARCH=amd64
  flags:
  - -trimpath
  - -buildvcs=false
  - -a
  ldflags:
  - -s -w -buildid=''
  - -X github.com/edgelesssys/constellation/v2/internal/constants.VersionInfo=${PROJECT_VERSION}
  - -extldflags "-static"
